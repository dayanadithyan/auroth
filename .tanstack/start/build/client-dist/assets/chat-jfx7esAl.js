import{j as rt,c as ye,g as _e,r as We,a as T,b as Qt,u as Ye}from"./main-BziP_Jk2.js";function $e({className:t,type:e,...r}){return rt.jsx("input",{type:e,"data-slot":"input",className:ye("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",t),...r})}var Ie="vercel.ai.error",qe=Symbol.for(Ie),we,Ke=class be extends Error{constructor({name:e,message:r,cause:n}){super(r),this[we]=!0,this.name=e,this.cause=n}static isInstance(e){return be.hasMarker(e,Ie)}static hasMarker(e,r){const n=Symbol.for(r);return e!=null&&typeof e=="object"&&n in e&&typeof e[n]=="boolean"&&e[n]===!0}};we=qe;var dt=Ke;function Se(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Te="AI_InvalidArgumentError",Re=`vercel.ai.error.${Te}`,He=Symbol.for(Re),Ae,Ge=class extends dt{constructor({message:t,cause:e,argument:r}){super({name:Te,message:t,cause:e}),this[Ae]=!0,this.argument=r}static isInstance(t){return dt.hasMarker(t,Re)}};Ae=He;var Ce="AI_JSONParseError",ve=`vercel.ai.error.${Ce}`,ze=Symbol.for(ve),xe,oe=class extends dt{constructor({text:t,cause:e}){super({name:Ce,message:`JSON parsing failed: Text: ${t}.
Error message: ${Se(e)}`,cause:e}),this[xe]=!0,this.text=t}static isInstance(t){return dt.hasMarker(t,ve)}};xe=ze;var ke="AI_TypeValidationError",De=`vercel.ai.error.${ke}`,Xe=Symbol.for(De),Ne,Qe=class Jt extends dt{constructor({value:e,cause:r}){super({name:ke,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Se(r)}`,cause:r}),this[Ne]=!0,this.value=e}static isInstance(e){return dt.hasMarker(e,De)}static wrap({value:e,cause:r}){return Jt.isInstance(r)&&r.value===e?r:new Jt({value:e,cause:r})}};Ne=Xe;var ie=Qe;let Ze=(t,e=21)=>(r=e)=>{let n="",s=r|0;for(;s--;)n+=t[Math.random()*t.length|0];return n};var ot={exports:{}},ce;function tr(){if(ce)return ot.exports;ce=1;const t=typeof Buffer<"u",e=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,r=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(l,a,o){o==null&&a!==null&&typeof a=="object"&&(o=a,a=void 0),t&&Buffer.isBuffer(l)&&(l=l.toString()),l&&l.charCodeAt(0)===65279&&(l=l.slice(1));const d=JSON.parse(l,a);if(d===null||typeof d!="object")return d;const f=o&&o.protoAction||"error",b=o&&o.constructorAction||"error";if(f==="ignore"&&b==="ignore")return d;if(f!=="ignore"&&b!=="ignore"){if(e.test(l)===!1&&r.test(l)===!1)return d}else if(f!=="ignore"&&b==="ignore"){if(e.test(l)===!1)return d}else if(r.test(l)===!1)return d;return s(d,{protoAction:f,constructorAction:b,safe:o&&o.safe})}function s(l,{protoAction:a="error",constructorAction:o="error",safe:d}={}){let f=[l];for(;f.length;){const b=f;f=[];for(const h of b){if(a!=="ignore"&&Object.prototype.hasOwnProperty.call(h,"__proto__")){if(d===!0)return null;if(a==="error")throw new SyntaxError("Object contains forbidden prototype property");delete h.__proto__}if(o!=="ignore"&&Object.prototype.hasOwnProperty.call(h,"constructor")&&Object.prototype.hasOwnProperty.call(h.constructor,"prototype")){if(d===!0)return null;if(o==="error")throw new SyntaxError("Object contains forbidden prototype property");delete h.constructor}for(const v in h){const I=h[v];I&&typeof I=="object"&&f.push(I)}}}return l}function i(l,a,o){const d=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(l,a,o)}finally{Error.stackTraceLimit=d}}function u(l,a){const o=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(l,a,{safe:!0})}catch{return null}finally{Error.stackTraceLimit=o}}return ot.exports=i,ot.exports.default=i,ot.exports.parse=i,ot.exports.safeParse=u,ot.exports.scan=s,ot.exports}var er=tr();const rr=_e(er);var nr=({prefix:t,size:e=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const s=Ze(r,e);if(t==null)return s;if(r.includes(n))throw new Ge({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return i=>`${t}${n}${s(i)}`},Zt=nr(),Ut=Symbol.for("vercel.ai.validator");function sr(t){return{[Ut]:!0,validate:t}}function ar(t){return typeof t=="object"&&t!==null&&Ut in t&&t[Ut]===!0&&"validate"in t}function or(t){return ar(t)?t:ir(t)}function ir(t){return sr(e=>{const r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}})}function cr({value:t,schema:e}){const r=or(e);try{if(r.validate==null)return{success:!0,value:t};const n=r.validate(t);return n.success?n:{success:!1,error:ie.wrap({value:t,cause:n.error})}}catch(n){return{success:!1,error:ie.wrap({value:t,cause:n})}}}function le({text:t,schema:e}){try{const r=rr.parse(t);if(e==null)return{success:!0,value:r,rawValue:r};const n=cr({value:r,schema:e});return n.success?{...n,rawValue:r}:n}catch(r){return{success:!1,error:oe.isInstance(r)?r:new oe({text:t,cause:r})}}}new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");var gt={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},mt={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},Et={code:"4",name:"assistant_message",parse:t=>{if(t==null||typeof t!="object"||!("id"in t)||!("role"in t)||!("content"in t)||typeof t.id!="string"||typeof t.role!="string"||t.role!=="assistant"||!Array.isArray(t.content)||!t.content.every(e=>e!=null&&typeof e=="object"&&"type"in e&&e.type==="text"&&"text"in e&&e.text!=null&&typeof e.text=="object"&&"value"in e.text&&typeof e.text.value=="string"))throw new Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:t}}},yt={code:"5",name:"assistant_control_data",parse:t=>{if(t==null||typeof t!="object"||!("threadId"in t)||!("messageId"in t)||typeof t.threadId!="string"||typeof t.messageId!="string")throw new Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:t.threadId,messageId:t.messageId}}}},_t={code:"6",name:"data_message",parse:t=>{if(t==null||typeof t!="object"||!("role"in t)||!("data"in t)||typeof t.role!="string"||t.role!=="data")throw new Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:t}}},lr=[gt,mt,Et,yt,_t];gt.code+"",mt.code+"",Et.code+"",yt.code+"",_t.code+"";gt.name+"",gt.code,mt.name+"",mt.code,Et.name+"",Et.code,yt.name+"",yt.code,_t.name+"",_t.code;lr.map(t=>t.code);function ur({promptTokens:t,completionTokens:e}){return{promptTokens:t,completionTokens:e,totalTokens:t+e}}function fr(t){const e=["ROOT"];let r=-1,n=null;function s(a,o,d){switch(a){case'"':{r=o,e.pop(),e.push(d),e.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=o,n=o,e.pop(),e.push(d),e.push("INSIDE_LITERAL");break}case"-":{e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=o,e.pop(),e.push(d),e.push("INSIDE_NUMBER");break}case"{":{r=o,e.pop(),e.push(d),e.push("INSIDE_OBJECT_START");break}case"[":{r=o,e.pop(),e.push(d),e.push("INSIDE_ARRAY_START");break}}}function i(a,o){switch(a){case",":{e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=o,e.pop();break}}}function u(a,o){switch(a){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=o,e.pop();break}}}for(let a=0;a<t.length;a++){const o=t[a];switch(e[e.length-1]){case"ROOT":s(o,a,"FINISH");break;case"INSIDE_OBJECT_START":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}case"}":{r=a,e.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(o){case'"':{e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(o){case":":{e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{s(o,a,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{i(o,a);break}case"INSIDE_STRING":{switch(o){case'"':{e.pop(),r=a;break}case"\\":{e.push("INSIDE_STRING_ESCAPE");break}default:r=a}break}case"INSIDE_ARRAY_START":{switch(o){case"]":{r=a,e.pop();break}default:{r=a,s(o,a,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(o){case",":{e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=a,e.pop();break}default:{r=a;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{s(o,a,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{e.pop(),r=a;break}case"INSIDE_NUMBER":{switch(o){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=a;break}case"e":case"E":case"-":case".":break;case",":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(o,a),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&i(o,a);break}case"}":{e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&i(o,a);break}case"]":{e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(o,a);break}default:{e.pop();break}}break}case"INSIDE_LITERAL":{const f=t.substring(n,a+1);!"false".startsWith(f)&&!"true".startsWith(f)&&!"null".startsWith(f)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?i(o,a):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&u(o,a)):r=a;break}}}let l=t.slice(0,r+1);for(let a=e.length-1;a>=0;a--)switch(e[a]){case"INSIDE_STRING":{l+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{l+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{l+="]";break}case"INSIDE_LITERAL":{const d=t.substring(n,t.length);"true".startsWith(d)?l+="true".slice(d.length):"false".startsWith(d)?l+="false".slice(d.length):"null".startsWith(d)&&(l+="null".slice(d.length))}}return l}function dr(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=le({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=le({text:fr(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}var pr={code:"0",name:"text",parse:t=>{if(typeof t!="string")throw new Error('"text" parts expect a string value.');return{type:"text",value:t}}},hr={code:"2",name:"data",parse:t=>{if(!Array.isArray(t))throw new Error('"data" parts expect an array value.');return{type:"data",value:t}}},gr={code:"3",name:"error",parse:t=>{if(typeof t!="string")throw new Error('"error" parts expect a string value.');return{type:"error",value:t}}},mr={code:"8",name:"message_annotations",parse:t=>{if(!Array.isArray(t))throw new Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:t}}},Er={code:"9",name:"tool_call",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string"||!("args"in t)||typeof t.args!="object")throw new Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:t}}},yr={code:"a",name:"tool_result",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("result"in t))throw new Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:t}}},_r={code:"b",name:"tool_call_streaming_start",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("toolName"in t)||typeof t.toolName!="string")throw new Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:t}}},Ir={code:"c",name:"tool_call_delta",parse:t=>{if(t==null||typeof t!="object"||!("toolCallId"in t)||typeof t.toolCallId!="string"||!("argsTextDelta"in t)||typeof t.argsTextDelta!="string")throw new Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:t}}},wr={code:"d",name:"finish_message",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_message" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),{type:"finish_message",value:e}}},br={code:"e",name:"finish_step",parse:t=>{if(t==null||typeof t!="object"||!("finishReason"in t)||typeof t.finishReason!="string")throw new Error('"finish_step" parts expect an object with a "finishReason" property.');const e={finishReason:t.finishReason,isContinued:!1};return"usage"in t&&t.usage!=null&&typeof t.usage=="object"&&"promptTokens"in t.usage&&"completionTokens"in t.usage&&(e.usage={promptTokens:typeof t.usage.promptTokens=="number"?t.usage.promptTokens:Number.NaN,completionTokens:typeof t.usage.completionTokens=="number"?t.usage.completionTokens:Number.NaN}),"isContinued"in t&&typeof t.isContinued=="boolean"&&(e.isContinued=t.isContinued),{type:"finish_step",value:e}}},Sr={code:"f",name:"start_step",parse:t=>{if(t==null||typeof t!="object"||!("messageId"in t)||typeof t.messageId!="string")throw new Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:t.messageId}}}},Tr={code:"g",name:"reasoning",parse:t=>{if(typeof t!="string")throw new Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:t}}},Rr={code:"h",name:"source",parse:t=>{if(t==null||typeof t!="object")throw new Error('"source" parts expect a Source object.');return{type:"source",value:t}}},Ar={code:"i",name:"redacted_reasoning",parse:t=>{if(t==null||typeof t!="object"||!("data"in t)||typeof t.data!="string")throw new Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:t.data}}}},Cr={code:"j",name:"reasoning_signature",parse:t=>{if(t==null||typeof t!="object"||!("signature"in t)||typeof t.signature!="string")throw new Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:t.signature}}}},vr={code:"k",name:"file",parse:t=>{if(t==null||typeof t!="object"||!("data"in t)||typeof t.data!="string"||!("mimeType"in t)||typeof t.mimeType!="string")throw new Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:t}}},te=[pr,hr,gr,mr,Er,yr,_r,Ir,wr,br,Sr,Tr,Rr,Ar,Cr,vr],xr=Object.fromEntries(te.map(t=>[t.code,t]));Object.fromEntries(te.map(t=>[t.name,t.code]));var kr=te.map(t=>t.code),Dr=t=>{const e=t.indexOf(":");if(e===-1)throw new Error("Failed to parse stream string. No separator found.");const r=t.slice(0,e);if(!kr.includes(r))throw new Error(`Failed to parse stream string. Invalid code ${r}.`);const n=r,s=t.slice(e+1),i=JSON.parse(s);return xr[n].parse(i)},Nr=10;function Or(t,e){const r=new Uint8Array(e);let n=0;for(const s of t)r.set(s,n),n+=s.length;return t.length=0,r}async function Lr({stream:t,onTextPart:e,onReasoningPart:r,onReasoningSignaturePart:n,onRedactedReasoningPart:s,onSourcePart:i,onFilePart:u,onDataPart:l,onErrorPart:a,onToolCallStreamingStartPart:o,onToolCallDeltaPart:d,onToolCallPart:f,onToolResultPart:b,onMessageAnnotationsPart:h,onFinishMessagePart:v,onFinishStepPart:I,onStartStepPart:M}){const p=t.getReader(),F=new TextDecoder,O=[];let x=0;for(;;){const{value:E}=await p.read();if(E&&(O.push(E),x+=E.length,E[E.length-1]!==Nr))continue;if(O.length===0)break;const c=Or(O,x);x=0;const S=F.decode(c,{stream:!0}).split(`
`).filter(g=>g!=="").map(Dr);for(const{type:g,value:y}of S)switch(g){case"text":await e?.(y);break;case"reasoning":await r?.(y);break;case"reasoning_signature":await n?.(y);break;case"redacted_reasoning":await s?.(y);break;case"file":await u?.(y);break;case"source":await i?.(y);break;case"data":await l?.(y);break;case"error":await a?.(y);break;case"message_annotations":await h?.(y);break;case"tool_call_streaming_start":await o?.(y);break;case"tool_call_delta":await d?.(y);break;case"tool_call":await f?.(y);break;case"tool_result":await b?.(y);break;case"finish_message":await v?.(y);break;case"finish_step":await I?.(y);break;case"start_step":await M?.(y);break;default:{const k=g;throw new Error(`Unknown stream part type: ${k}`)}}}}async function Pr({stream:t,update:e,onToolCall:r,onFinish:n,generateId:s=Zt,getCurrentDate:i=()=>new Date,lastMessage:u}){var l,a;const o=u?.role==="assistant";let d=o?1+((a=(l=u.toolInvocations)==null?void 0:l.reduce((c,S)=>{var g;return Math.max(c,(g=S.step)!=null?g:0)},0))!=null?a:0):0;const f=o?structuredClone(u):{id:s(),createdAt:i(),role:"assistant",content:"",parts:[]};let b,h,v;function I(c,S){const g=f.parts.find(y=>y.type==="tool-invocation"&&y.toolInvocation.toolCallId===c);g!=null?g.toolInvocation=S:f.parts.push({type:"tool-invocation",toolInvocation:S})}const M=[];let p=o?u?.annotations:void 0;const F={};let O={completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},x="unknown";function E(){const c=[...M];p?.length&&(f.annotations=p);const S={...structuredClone(f),revisionId:s()};e({message:S,data:c,replaceLastMessage:o})}await Lr({stream:t,onTextPart(c){b==null?(b={type:"text",text:c},f.parts.push(b)):b.text+=c,f.content+=c,E()},onReasoningPart(c){var S;v==null?(v={type:"text",text:c},h?.details.push(v)):v.text+=c,h==null?(h={type:"reasoning",reasoning:c,details:[v]},f.parts.push(h)):h.reasoning+=c,f.reasoning=((S=f.reasoning)!=null?S:"")+c,E()},onReasoningSignaturePart(c){v!=null&&(v.signature=c.signature)},onRedactedReasoningPart(c){h==null&&(h={type:"reasoning",reasoning:"",details:[]},f.parts.push(h)),h.details.push({type:"redacted",data:c.data}),v=void 0,E()},onFilePart(c){f.parts.push({type:"file",mimeType:c.mimeType,data:c.data}),E()},onSourcePart(c){f.parts.push({type:"source",source:c}),E()},onToolCallStreamingStartPart(c){f.toolInvocations==null&&(f.toolInvocations=[]),F[c.toolCallId]={text:"",step:d,toolName:c.toolName,index:f.toolInvocations.length};const S={state:"partial-call",step:d,toolCallId:c.toolCallId,toolName:c.toolName,args:void 0};f.toolInvocations.push(S),I(c.toolCallId,S),E()},onToolCallDeltaPart(c){const S=F[c.toolCallId];S.text+=c.argsTextDelta;const{value:g}=dr(S.text),y={state:"partial-call",step:S.step,toolCallId:c.toolCallId,toolName:S.toolName,args:g};f.toolInvocations[S.index]=y,I(c.toolCallId,y),E()},async onToolCallPart(c){const S={state:"call",step:d,...c};if(F[c.toolCallId]!=null?f.toolInvocations[F[c.toolCallId].index]=S:(f.toolInvocations==null&&(f.toolInvocations=[]),f.toolInvocations.push(S)),I(c.toolCallId,S),E(),r){const g=await r({toolCall:c});if(g!=null){const y={state:"result",step:d,...c,result:g};f.toolInvocations[f.toolInvocations.length-1]=y,I(c.toolCallId,y),E()}}},onToolResultPart(c){const S=f.toolInvocations;if(S==null)throw new Error("tool_result must be preceded by a tool_call");const g=S.findIndex(k=>k.toolCallId===c.toolCallId);if(g===-1)throw new Error("tool_result must be preceded by a tool_call with the same toolCallId");const y={...S[g],state:"result",...c};S[g]=y,I(c.toolCallId,y),E()},onDataPart(c){M.push(...c),E()},onMessageAnnotationsPart(c){p==null?p=[...c]:p.push(...c),E()},onFinishStepPart(c){d+=1,b=c.isContinued?b:void 0,h=void 0,v=void 0},onStartStepPart(c){o||(f.id=c.messageId),f.parts.push({type:"step-start"}),E()},onFinishMessagePart(c){x=c.finishReason,c.usage!=null&&(O=ur(c.usage))},onErrorPart(c){throw new Error(c)}}),n?.({message:f,finishReason:x,usage:O})}async function Fr({stream:t,onTextPart:e}){const r=t.pipeThrough(new TextDecoderStream).getReader();for(;;){const{done:n,value:s}=await r.read();if(n)break;await e(s)}}async function Mr({stream:t,update:e,onFinish:r,getCurrentDate:n=()=>new Date,generateId:s=Zt}){const i={type:"text",text:""},u={id:s(),createdAt:n(),role:"assistant",content:"",parts:[i]};await Fr({stream:t,onTextPart:l=>{u.content+=l,i.text+=l,e({message:{...u},data:[],replaceLastMessage:!1})}}),r?.(u,{usage:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN},finishReason:"unknown"})}var Vr=()=>fetch;async function jr({api:t,body:e,streamProtocol:r="data",credentials:n,headers:s,abortController:i,restoreMessagesOnFailure:u,onResponse:l,onUpdate:a,onFinish:o,onToolCall:d,generateId:f,fetch:b=Vr(),lastMessage:h,requestType:v="generate"}){var I,M,p;const O=await(v==="resume"?b(`${t}?chatId=${e.id}`,{method:"GET",headers:{"Content-Type":"application/json",...s},signal:(I=i?.())==null?void 0:I.signal,credentials:n}):b(t,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json",...s},signal:(M=i?.())==null?void 0:M.signal,credentials:n})).catch(x=>{throw u(),x});if(l)try{await l(O)}catch(x){throw x}if(!O.ok)throw u(),new Error((p=await O.text())!=null?p:"Failed to fetch the chat response.");if(!O.body)throw new Error("The response body is empty.");switch(r){case"text":{await Mr({stream:O.body,update:a,onFinish:o,generateId:f});return}case"data":{await Pr({stream:O.body,update:a,lastMessage:h,onToolCall:d,onFinish({message:x,finishReason:E,usage:c}){o&&x!=null&&o(x,{usage:c,finishReason:E})},generateId:f});return}default:{const x=r;throw new Error(`Unknown stream protocol: ${x}`)}}}function Bt(t){return t?.reduce((e,r)=>{var n;return Math.max(e,(n=r.step)!=null?n:0)},0)}function Oe(t){var e;return(e=t.parts)!=null?e:[...t.toolInvocations?t.toolInvocations.map(r=>({type:"tool-invocation",toolInvocation:r})):[],...t.reasoning?[{type:"reasoning",reasoning:t.reasoning,details:[{type:"text",text:t.reasoning}]}]:[],...t.content?[{type:"text",text:t.content}]:[]]}function Nt(t){return t.map(e=>({...e,parts:Oe(e)}))}function Wt(t,e){if(t===e)return!0;if(t==null||e==null)return!1;if(typeof t!="object"&&typeof e!="object")return t===e;if(t.constructor!==e.constructor)return!1;if(t instanceof Date&&e instanceof Date)return t.getTime()===e.getTime();if(Array.isArray(t)){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(!Wt(t[s],e[s]))return!1;return!0}const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s of r)if(!n.includes(s)||!Wt(t[s],e[s]))return!1;return!0}async function ue(t){if(!t)return[];if(globalThis.FileList&&t instanceof globalThis.FileList)return Promise.all(Array.from(t).map(async e=>{const{name:r,type:n}=e,s=await new Promise((i,u)=>{const l=new FileReader;l.onload=a=>{var o;i((o=a.target)==null?void 0:o.result)},l.onerror=a=>u(a),l.readAsDataURL(e)});return{name:r,contentType:n,url:s}}));if(Array.isArray(t))return t;throw new Error("Invalid attachments type")}function Jr({originalMaxToolInvocationStep:t,originalMessageCount:e,maxSteps:r,messages:n}){var s;const i=n[n.length-1];return r>1&&i!=null&&(n.length>e||Bt(i.toolInvocations)!==t)&&Le(i)&&((s=Bt(i.toolInvocations))!=null?s:0)<r}function Le(t){if(t.role!=="assistant")return!1;const e=t.parts.reduce((n,s,i)=>s.type==="step-start"?i:n,-1),r=t.parts.slice(e+1).filter(n=>n.type==="tool-invocation");return r.length>0&&r.every(n=>"result"in n.toolInvocation)}function Ur({messages:t,toolCallId:e,toolResult:r}){var n;const s=t[t.length-1],i=s.parts.find(l=>l.type==="tool-invocation"&&l.toolInvocation.toolCallId===e);if(i==null)return;const u={...i.toolInvocation,state:"result",result:r};i.toolInvocation=u,s.toolInvocations=(n=s.toolInvocations)==null?void 0:n.map(l=>l.toolCallId===e?u:l)}var Br=We();const Pe=0,Fe=1,Me=2,fe=3;var de=Object.prototype.hasOwnProperty;function Yt(t,e){var r,n;if(t===e)return!0;if(t&&e&&(r=t.constructor)===e.constructor){if(r===Date)return t.getTime()===e.getTime();if(r===RegExp)return t.toString()===e.toString();if(r===Array){if((n=t.length)===e.length)for(;n--&&Yt(t[n],e[n]););return n===-1}if(!r||typeof t=="object"){n=0;for(r in t)if(de.call(t,r)&&++n&&!de.call(e,r)||!(r in e)||!Yt(t[r],e[r]))return!1;return Object.keys(e).length===n}}return t!==t&&e!==e}const Z=new WeakMap,nt=()=>{},J=nt(),$t=Object,A=t=>t===J,z=t=>typeof t=="function",st=(t,e)=>({...t,...e}),Ve=t=>z(t.then),Ot={},vt={},ee="undefined",wt=typeof window!=ee,qt=typeof document!=ee,Wr=wt&&"Deno"in window,Yr=()=>wt&&typeof window.requestAnimationFrame!=ee,je=(t,e)=>{const r=Z.get(t);return[()=>!A(e)&&t.get(e)||Ot,n=>{if(!A(e)){const s=t.get(e);e in vt||(vt[e]=s),r[5](e,st(s,n),s||Ot)}},r[6],()=>!A(e)&&e in vt?vt[e]:!A(e)&&t.get(e)||Ot]};let Kt=!0;const $r=()=>Kt,[Ht,Gt]=wt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[nt,nt],qr=()=>{const t=qt&&document.visibilityState;return A(t)||t!=="hidden"},Kr=t=>(qt&&document.addEventListener("visibilitychange",t),Ht("focus",t),()=>{qt&&document.removeEventListener("visibilitychange",t),Gt("focus",t)}),Hr=t=>{const e=()=>{Kt=!0,t()},r=()=>{Kt=!1};return Ht("online",e),Ht("offline",r),()=>{Gt("online",e),Gt("offline",r)}},Gr={isOnline:$r,isVisible:qr},zr={initFocus:Kr,initReconnect:Hr},pe=!Qt.useId,It=!wt||Wr,Xr=t=>Yr()?window.requestAnimationFrame(t):setTimeout(t,1),Lt=It?T.useEffect:T.useLayoutEffect,Pt=typeof navigator<"u"&&navigator.connection,he=!It&&Pt&&(["slow-2g","2g"].includes(Pt.effectiveType)||Pt.saveData),xt=new WeakMap,Ft=(t,e)=>$t.prototype.toString.call(t)===`[object ${e}]`;let Qr=0;const zt=t=>{const e=typeof t,r=Ft(t,"Date"),n=Ft(t,"RegExp"),s=Ft(t,"Object");let i,u;if($t(t)===t&&!r&&!n){if(i=xt.get(t),i)return i;if(i=++Qr+"~",xt.set(t,i),Array.isArray(t)){for(i="@",u=0;u<t.length;u++)i+=zt(t[u])+",";xt.set(t,i)}if(s){i="#";const l=$t.keys(t).sort();for(;!A(u=l.pop());)A(t[u])||(i+=u+":"+zt(t[u])+",");xt.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},re=t=>{if(z(t))try{t=t()}catch{t=""}const e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?zt(t):"",[t,e]};let Zr=0;const Xt=()=>++Zr;async function Je(...t){const[e,r,n,s]=t,i=st({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{});let u=i.populateCache;const l=i.rollbackOnError;let a=i.optimisticData;const o=b=>typeof l=="function"?l(b):l!==!1,d=i.throwOnError;if(z(r)){const b=r,h=[],v=e.keys();for(const I of v)!/^\$(inf|sub)\$/.test(I)&&b(e.get(I)._k)&&h.push(I);return Promise.all(h.map(f))}return f(r);async function f(b){const[h]=re(b);if(!h)return;const[v,I]=je(e,h),[M,p,F,O]=Z.get(e),x=()=>{const L=M[h];return(z(i.revalidate)?i.revalidate(v().data,b):i.revalidate!==!1)&&(delete F[h],delete O[h],L&&L[0])?L[0](Me).then(()=>v().data):v().data};if(t.length<3)return x();let E=n,c;const S=Xt();p[h]=[S,0];const g=!A(a),y=v(),k=y.data,K=y._c,q=A(K)?k:K;if(g&&(a=z(a)?a(q,k):a,I({data:a,_c:q})),z(E))try{E=E(q)}catch(L){c=L}if(E&&Ve(E))if(E=await E.catch(L=>{c=L}),S!==p[h][0]){if(c)throw c;return E}else c&&g&&o(c)&&(u=!0,I({data:q,_c:J}));if(u&&!c)if(z(u)){const L=u(E,q);I({data:L,error:J,_c:J})}else I({data:E,error:J,_c:J});if(p[h][1]=Xt(),Promise.resolve(x()).then(()=>{I({_c:J})}),c){if(d)throw c;return}return E}}const ge=(t,e)=>{for(const r in t)t[r][0]&&t[r][0](e)},tn=(t,e)=>{if(!Z.has(t)){const r=st(zr,e),n=Object.create(null),s=Je.bind(J,t);let i=nt;const u=Object.create(null),l=(d,f)=>{const b=u[d]||[];return u[d]=b,b.push(f),()=>b.splice(b.indexOf(f),1)},a=(d,f,b)=>{t.set(d,f);const h=u[d];if(h)for(const v of h)v(f,b)},o=()=>{if(!Z.has(t)&&(Z.set(t,[n,Object.create(null),Object.create(null),Object.create(null),s,a,l]),!It)){const d=r.initFocus(setTimeout.bind(J,ge.bind(J,n,Pe))),f=r.initReconnect(setTimeout.bind(J,ge.bind(J,n,Fe)));i=()=>{d&&d(),f&&f(),Z.delete(t)}}};return o(),[t,s,o,i]}return[t,Z.get(t)[4]]},en=(t,e,r,n,s)=>{const i=r.errorRetryCount,u=s.retryCount,l=~~((Math.random()+.5)*(1<<(u<8?u:8)))*r.errorRetryInterval;!A(i)&&u>i||setTimeout(n,l,s)},rn=Yt,[Ue,nn]=tn(new Map),sn=st({onLoadingSlow:nt,onSuccess:nt,onError:nt,onErrorRetry:en,onDiscarded:nt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:he?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:he?5e3:3e3,compare:rn,isPaused:()=>!1,cache:Ue,mutate:nn,fallback:{}},Gr),an=(t,e)=>{const r=st(t,e);if(e){const{use:n,fallback:s}=t,{use:i,fallback:u}=e;n&&i&&(r.use=n.concat(i)),s&&u&&(r.fallback=st(s,u))}return r},on=T.createContext({}),cn="$inf$",Be=wt&&window.__SWR_DEVTOOLS_USE__,ln=Be?window.__SWR_DEVTOOLS_USE__:[],un=()=>{Be&&(window.__SWR_DEVTOOLS_REACT__=Qt)},fn=t=>z(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],dn=()=>st(sn,T.useContext(on)),pn=t=>(e,r,n)=>t(e,r&&((...i)=>{const[u]=re(e),[,,,l]=Z.get(Ue);if(u.startsWith(cn))return r(...i);const a=l[u];return A(a)?r(...i):(delete l[u],a)}),n),hn=ln.concat(pn),gn=t=>function(...r){const n=dn(),[s,i,u]=fn(r),l=an(n,u);let a=t;const{use:o}=l,d=(o||[]).concat(hn);for(let f=d.length;f--;)a=d[f](a);return a(s,i||l.fetcher||null,l)},mn=(t,e,r)=>{const n=e[t]||(e[t]=[]);return n.push(r),()=>{const s=n.indexOf(r);s>=0&&(n[s]=n[n.length-1],n.pop())}};un();const Mt=Qt.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),Vt={dedupe:!0},En=(t,e,r)=>{const{cache:n,compare:s,suspense:i,fallbackData:u,revalidateOnMount:l,revalidateIfStale:a,refreshInterval:o,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:b}=r,[h,v,I,M]=Z.get(n),[p,F]=re(t),O=T.useRef(!1),x=T.useRef(!1),E=T.useRef(p),c=T.useRef(e),S=T.useRef(r),g=()=>S.current,y=()=>g().isVisible()&&g().isOnline(),[k,K,q,L]=je(n,p),U=T.useRef({}).current,H=A(u)?A(r.fallback)?J:r.fallback[p]:u,bt=(_,m)=>{for(const C in U){const w=C;if(w==="data"){if(!s(_[w],m[w])&&(!A(_[w])||!s(lt,m[w])))return!1}else if(m[w]!==_[w])return!1}return!0},it=T.useMemo(()=>{const _=!p||!e?!1:A(l)?g().isPaused()||i?!1:a!==!1:l,m=D=>{const Y=st(D);return delete Y._k,_?{isValidating:!0,isLoading:!0,...Y}:Y},C=k(),w=L(),P=m(C),W=C===w?P:m(w);let N=P;return[()=>{const D=m(k());return bt(D,N)?(N.data=D.data,N.isLoading=D.isLoading,N.isValidating=D.isValidating,N.error=D.error,N):(N=D,D)},()=>W]},[n,p]),V=Br.useSyncExternalStore(T.useCallback(_=>q(p,(m,C)=>{bt(C,m)||_()}),[n,p]),it[0],it[1]),G=!O.current,B=h[p]&&h[p].length>0,tt=V.data,X=A(tt)?H&&Ve(H)?Mt(H):H:tt,ct=V.error,pt=T.useRef(X),lt=b?A(tt)?A(pt.current)?X:pt.current:tt:X,St=B&&!A(ct)?!1:G&&!A(l)?l:g().isPaused()?!1:i?A(X)?!1:a:A(X)||a,et=!!(p&&e&&G&&St),ht=A(V.isValidating)?et:V.isValidating,Dt=A(V.isLoading)?et:V.isLoading,at=T.useCallback(async _=>{const m=c.current;if(!p||!m||x.current||g().isPaused())return!1;let C,w,P=!0;const W=_||{},N=!I[p]||!W.dedupe,D=()=>pe?!x.current&&p===E.current&&O.current:p===E.current,Y={isValidating:!1,isLoading:!1},Rt=()=>{K(Y)},At=()=>{const j=I[p];j&&j[1]===w&&delete I[p]},Ct={isValidating:!0};A(k().data)&&(Ct.isLoading=!0);try{if(N&&(K(Ct),r.loadingTimeout&&A(k().data)&&setTimeout(()=>{P&&D()&&g().onLoadingSlow(p,r)},r.loadingTimeout),I[p]=[m(F),Xt()]),[C,w]=I[p],C=await C,N&&setTimeout(At,r.dedupingInterval),!I[p]||I[p][1]!==w)return N&&D()&&g().onDiscarded(p),!1;Y.error=J;const j=v[p];if(!A(j)&&(w<=j[0]||w<=j[1]||j[1]===0))return Rt(),N&&D()&&g().onDiscarded(p),!1;const $=k().data;Y.data=s($,C)?$:C,N&&D()&&g().onSuccess(C,p,r)}catch(j){At();const $=g(),{shouldRetryOnError:Q}=$;$.isPaused()||(Y.error=j,N&&D()&&($.onError(j,p,$),(Q===!0||z(Q)&&Q(j))&&(!g().revalidateOnFocus||!g().revalidateOnReconnect||y())&&$.onErrorRetry(j,p,$,ut=>{const ft=h[p];ft&&ft[0]&&ft[0](fe,ut)},{retryCount:(W.retryCount||0)+1,dedupe:!0})))}return P=!1,Rt(),!0},[p,n]),Tt=T.useCallback((..._)=>Je(n,E.current,..._),[]);if(Lt(()=>{c.current=e,S.current=r,A(tt)||(pt.current=tt)}),Lt(()=>{if(!p)return;const _=at.bind(J,Vt);let m=0;g().revalidateOnFocus&&(m=Date.now()+g().focusThrottleInterval);const w=mn(p,h,(P,W={})=>{if(P==Pe){const N=Date.now();g().revalidateOnFocus&&N>m&&y()&&(m=N+g().focusThrottleInterval,_())}else if(P==Fe)g().revalidateOnReconnect&&y()&&_();else{if(P==Me)return at();if(P==fe)return at(W)}});return x.current=!1,E.current=p,O.current=!0,K({_k:F}),St&&(A(X)||It?_():Xr(_)),()=>{x.current=!0,w()}},[p]),Lt(()=>{let _;function m(){const w=z(o)?o(k().data):o;w&&_!==-1&&(_=setTimeout(C,w))}function C(){!k().error&&(d||g().isVisible())&&(f||g().isOnline())?at(Vt).then(m):m()}return m(),()=>{_&&(clearTimeout(_),_=-1)}},[o,d,f,p]),T.useDebugValue(lt),i&&A(X)&&p){if(!pe&&It)throw new Error("Fallback data is required when using Suspense in SSR.");c.current=e,S.current=r,x.current=!1;const _=M[p];if(!A(_)){const m=Tt(_);Mt(m)}if(A(ct)){const m=at(Vt);A(lt)||(m.status="fulfilled",m.value=!0),Mt(m)}else throw ct}return{mutate:Tt,get data(){return U.data=!0,lt},get error(){return U.error=!0,ct},get isValidating(){return U.isValidating=!0,ht},get isLoading(){return U.isLoading=!0,Dt}}},kt=gn(En);var jt,me;function yn(){if(me)return jt;me=1;function t(e,r){if(typeof e!="function")throw new TypeError(`Expected the first argument to be a \`function\`, got \`${typeof e}\`.`);let n,s=0;return function(...u){clearTimeout(n);const l=Date.now(),a=l-s,o=r-a;o<=0?(s=l,e.apply(this,u)):n=setTimeout(()=>{s=Date.now(),e.apply(this,u)},o)}}return jt=t,jt}var _n=yn();const In=_e(_n);function Ee(t,e){return e!=null?In(t,e):t}function wn(t){const[e,r]=T.useState(t);return T.useEffect(()=>{Wt(t,e)||r(t)},[t,e]),e}function bn({api:t="/api/chat",id:e,initialMessages:r,initialInput:n="",sendExtraMessageFields:s,onToolCall:i,experimental_prepareRequestBody:u,maxSteps:l=1,streamProtocol:a="data",onResponse:o,onFinish:d,onError:f,credentials:b,headers:h,body:v,generateId:I=Zt,fetch:M,keepLastMessageOnError:p=!0,experimental_throttle:F}={}){const[O]=T.useState(I),x=e??O,E=typeof t=="string"?[t,x]:x,c=wn(r??[]),S=T.useMemo(()=>Nt(c),[c]),{data:g,mutate:y}=kt([E,"messages"],null,{fallbackData:S}),k=T.useRef(g||[]);T.useEffect(()=>{k.current=g||[]},[g]);const{data:K,mutate:q}=kt([E,"streamData"],null),L=T.useRef(K);T.useEffect(()=>{L.current=K},[K]);const{data:U="ready",mutate:H}=kt([E,"status"],null),{data:bt=void 0,mutate:it}=kt([E,"error"],null),V=T.useRef(null),G=T.useRef({credentials:b,headers:h,body:v});T.useEffect(()=>{G.current={credentials:b,headers:h,body:v}},[b,h,v]);const B=T.useCallback(async(R,_="generate")=>{var m,C;H("submitted"),it(void 0);const w=Nt(R.messages),P=w.length,W=Bt((m=w[w.length-1])==null?void 0:m.toolInvocations);try{const D=new AbortController;V.current=D;const Y=Ee(y,F),Rt=Ee(q,F),At=k.current;Y(w,!1);const Ct=s?w:w.map(({role:$,content:Q,experimental_attachments:ut,data:ft,annotations:ne,toolInvocations:se,parts:ae})=>({role:$,content:Q,...ut!==void 0&&{experimental_attachments:ut},...ft!==void 0&&{data:ft},...ne!==void 0&&{annotations:ne},...se!==void 0&&{toolInvocations:se},...ae!==void 0&&{parts:ae}})),j=L.current;await jr({api:t,body:(C=u?.({id:x,messages:w,requestData:R.data,requestBody:R.body}))!=null?C:{id:x,messages:Ct,data:R.data,...G.current.body,...R.body},streamProtocol:a,credentials:G.current.credentials,headers:{...G.current.headers,...R.headers},abortController:()=>V.current,restoreMessagesOnFailure(){p||Y(At,!1)},onResponse:o,onUpdate({message:$,data:Q,replaceLastMessage:ut}){H("streaming"),Y([...ut?w.slice(0,w.length-1):w,$],!1),Q?.length&&Rt([...j??[],...Q],!1)},onToolCall:i,onFinish:d,generateId:I,fetch:M,lastMessage:w[w.length-1],requestType:_}),V.current=null,H("ready")}catch(D){if(D.name==="AbortError")return V.current=null,H("ready"),null;f&&D instanceof Error&&f(D),it(D),H("error")}const N=k.current;Jr({originalMaxToolInvocationStep:W,originalMessageCount:P,maxSteps:l,messages:N})&&await B({messages:N})},[y,H,t,G,o,d,f,it,q,L,a,s,u,i,l,k,V,I,M,p,F,x]),tt=T.useCallback(async(R,{data:_,headers:m,body:C,experimental_attachments:w=R.experimental_attachments}={})=>{var P,W;const N=await ue(w),D=k.current.concat({...R,id:(P=R.id)!=null?P:I(),createdAt:(W=R.createdAt)!=null?W:new Date,experimental_attachments:N.length>0?N:void 0,parts:Oe(R)});return B({messages:D,headers:m,body:C,data:_})},[B,I]),X=T.useCallback(async({data:R,headers:_,body:m}={})=>{const C=k.current;if(C.length===0)return null;const w=C[C.length-1];return B({messages:w.role==="assistant"?C.slice(0,-1):C,headers:_,body:m,data:R})},[B]),ct=T.useCallback(()=>{V.current&&(V.current.abort(),V.current=null)},[]),pt=T.useCallback(async()=>{const R=k.current;B({messages:R},"resume")},[B]),lt=T.useCallback(R=>{typeof R=="function"&&(R=R(k.current));const _=Nt(R);y(_,!1),k.current=_},[y]),St=T.useCallback(R=>{typeof R=="function"&&(R=R(L.current)),q(R,!1),L.current=R},[q]),[et,ht]=T.useState(n),Dt=T.useCallback(async(R,_={},m)=>{var C;if((C=R?.preventDefault)==null||C.call(R),!et&&!_.allowEmptySubmit)return;m&&(G.current={...G.current,...m});const w=await ue(_.experimental_attachments),W={messages:k.current.concat({id:I(),createdAt:new Date,role:"user",content:et,experimental_attachments:w.length>0?w:void 0,parts:[{type:"text",text:et}]}),headers:_.headers,body:_.body,data:_.data};B(W),ht("")},[et,I,B]),at=R=>{ht(R.target.value)},Tt=T.useCallback(({toolCallId:R,result:_})=>{const m=k.current;if(Ur({messages:m,toolCallId:R,toolResult:_}),y([...m.slice(0,m.length-1),{...m[m.length-1]}],!1),U==="submitted"||U==="streaming")return;const C=m[m.length-1];Le(C)&&B({messages:m})},[y,U,B]);return{messages:g??[],id:x,setMessages:lt,data:K,setData:St,error:bt,append:tt,reload:X,stop:ct,experimental_resume:pt,input:et,setInput:ht,handleInputChange:at,handleSubmit:Dt,isLoading:U==="submitted"||U==="streaming",status:U,addToolResult:Tt}}function Rn(t){const{messages:e,input:r,handleSubmit:n,handleInputChange:s,id:i,experimental_resume:u}=bn({id:t.id,initialMessages:t.chat?.[0]?.messages,sendExtraMessageFields:!0});console.log(i);const l=Ye();function a(o){return e.length<1&&l({to:"/chats/$chatId",params:{chatId:i}}),n(o)}return T.useEffect(()=>{u()},[]),rt.jsxs("div",{className:"relative h-full",children:[rt.jsx("div",{className:"space-y-2 flex flex-col",children:e.map(o=>rt.jsx(Sn,{message:o},o.id))}),rt.jsx("form",{onSubmit:a,children:rt.jsx($e,{className:"absolute bottom-1",placeholder:"Say hi to Auroth",onChange:s,value:r})})]})}function Sn(t){return rt.jsx("div",{className:ye("p-3 rounded-xl w-fit",t.message.role==="user"&&"self-end bg-card"),children:rt.jsx("p",{children:t.message.content})})}export{Rn as C};
